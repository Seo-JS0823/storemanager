<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.storemanager.in.InMapper">
	<!-- WHERE 에  gi_code 필요 -->
	<!-- 입고 기록리스트 가져오기 -->
	<select id="getInList" resultType="com.storemanager.in.InDTO">
		SELECT 
			b.gcm_name,
			a.gih_idx, 
			a.gcm_code, 
			a.gi_code, 
			a.gi_name, 
			a.gih_inout, 
			a.gih_qty, 
			a.gih_price, 
			a.gih_remark,
			TO_CHAR(a.gih_regdate,'YYYY-MM-DD') gih_regdate,
			a.gih_confirm, 
			(a.gih_qty * a.gih_price) tot_price
	  FROM GE_ITEMS_HIST a JOIN GE_COM_MEMBER b
	  ON a.gcm_code = b.gcm_code
		WHERE a.gih_qty > 0 
		AND DATE_FORMAT(a.gih_regdate,'%Y-%m-%d') BETWEEN #{dateStart} AND #{dateEnd}
		ORDER BY a.gih_regdate DESC
	</select>
	
	<!-- 주성 추가 -->
	<select id="getInListPaging" resultType="com.storemanager.in.InDTO">
		SELECT 
			b.gcm_name,
			a.gih_idx, 
			a.gcm_code, 
			a.gi_code, 
			a.gi_name, 
			a.gih_inout, 
			a.gih_qty, 
			a.gih_price, 
			a.gih_remark,
			TO_CHAR(a.gih_regdate,'YYYY-MM-DD') gih_regdate,
			a.gih_confirm, 
			(a.gih_qty * a.gih_price) tot_price
	  FROM GE_ITEMS_HIST a JOIN GE_COM_MEMBER b
	  ON a.gcm_code = b.gcm_code
		WHERE a.gih_qty > 0 
		AND DATE_FORMAT(a.gih_regdate,'%Y-%m-%d') BETWEEN #{dateStart} AND #{dateEnd}
		ORDER BY a.gih_regdate DESC
		LIMIT ${nowPage},10
	</select>
	
	<!-- 첫 모달창에 선택 가능한 물품명 리스트 가져오기 -->
	<select id="getItemsName" resultType="com.storemanager.in.InDTO">
		SELECT
			DISTINCT(gi_name) gi_name
		FROM
			GE_ITEMS
		WHERE GI_DEL_FLAG = 'N'
	</select>
	
	<!-- 주성 추가 -->
	<select id="getItemsNamePaging" resultType="com.storemanager.in.InDTO">
		SELECT
			DISTINCT(gi_name) gi_name,
			gi_code
		FROM
			GE_ITEMS
		LIMIT ${nowPage},10
	</select>
	
	<!-- 첫 모달창에 선택 가능한 거래처명 리스트 가져오기-->
	<select id="getCompanysName" resultType="com.storemanager.in.InDTO">
		SELECT
			DISTINCT(a.gcm_name),
			a.gcm_code
		FROM GE_COM_MEMBER a JOIN GE_ITEMS b
		ON a.gcm_code = b.gcm_code
		WHERE gi_name = #{gi_name} AND gmc_del_flag = 'N'		
	</select>
	
	<!-- 주성 추가 -->
	<select id="getCompanysNamePaging" resultType="com.storemanager.in.InDTO">
		SELECT
			DISTINCT(a.gcm_name),
			a.gcm_code
		FROM GE_COM_MEMBER a JOIN GE_ITEMS b
		ON a.gcm_code = b.gcm_code
		WHERE gi_name = #{gi_name}
		LIMIT ${nowPage},10		
	</select>
	
	<!-- 오른쪽 모달창에 출력할 물품코드 가져오기 -->
	<select id="getItemCode" resultType="int">
		SELECT
			gi_code
		FROM GE_ITEMS
		WHERE gi_name = #{gi_name} AND gcm_code = #{gcm_code}
	</select>
	
	<!-- 입고 완료 -->
	<insert id="insertIn" >
		INSERT INTO GE_ITEMS_HIST(
			gcm_code,
			gi_code,
			gi_name,
			gih_inout,
			gih_qty,
			gih_price,
			gih_remark
		)
		VALUES(
			#{gcm_code},
			#{gi_code},
			#{gi_name},
			'IN',
			#{gih_qty},
			#{gih_price},
			#{gih_remark}
		)
	</insert>
	
	<!-- 날짜기간 검색으로 리스트 뽑아오기 -->
	<select id="searchByRegdate" resultType="com.storemanager.in.InDTO">
		SELECT 
			b.gcm_name,
			a.gih_idx, 
			a.gcm_code, 
			a.gi_code, 
			a.gi_name, 
			a.gih_inout, 
			a.gih_qty, 
			a.gih_price, 
			a.gih_remark,
			TO_CHAR(a.gih_regdate,'YYYY-MM-DD') gih_regdate,
			a.gih_confirm, 
			(a.gih_qty * a.gih_price) tot_price
	  FROM GE_ITEMS_HIST a JOIN GE_COM_MEMBER b
	  ON a.gcm_code = b.gcm_code
		WHERE a.gih_qty > 0 
		AND DATE_FORMAT(a.gih_regdate,'%Y-%m-%d') BETWEEN #{start} AND #{end}
		ORDER BY a.gih_regdate DESC
	</select>
	
	<!-- 주성 추가 -->
	<select id="searchByRegdatePaging" resultType="com.storemanager.in.InDTO">
		SELECT 
			b.gcm_name,
			a.gih_idx, 
			a.gcm_code, 
			a.gi_code, 
			a.gi_name, 
			a.gih_inout, 
			a.gih_qty, 
			a.gih_price, 
			a.gih_remark,
			TO_CHAR(a.gih_regdate,'YYYY-MM-DD') gih_regdate,
			a.gih_confirm, 
			(a.gih_qty * a.gih_price) tot_price
	  FROM GE_ITEMS_HIST a JOIN GE_COM_MEMBER b
	  ON a.gcm_code = b.gcm_code
		WHERE a.gih_qty > 0 
		AND DATE_FORMAT(a.gih_regdate,'%Y-%m-%d') BETWEEN #{start} AND #{end}
		ORDER BY a.gih_regdate DESC
		LIMIT ${nowPage},10
	</select>
	
	<!-- 물품 검색으로 리스트 뽑아오기 -->
	<select id="searchByGi_name" resultType="com.storemanager.in.InDTO">
		SELECT 
			b.gcm_name,
			a.gih_idx, 
			a.gcm_code, 
			a.gi_code, 
			a.gi_name, 
			a.gih_inout, 
			a.gih_qty, 
			a.gih_price, 
			a.gih_remark,
			TO_CHAR(a.gih_regdate,'YYYY-MM-DD') gih_regdate,
			a.gih_confirm, 
			(a.gih_qty * a.gih_price) tot_price
	  FROM GE_ITEMS_HIST a JOIN GE_COM_MEMBER b
	  ON a.gcm_code = b.gcm_code
		WHERE a.gih_qty > 0 AND a.gi_name = #{gi_name}
		<if test="start != null and end!= null">
		  AND DATE_FORMAT(a.gih_regdate,'%Y-%m-%d') BETWEEN #{start} AND #{end}
		</if>
		ORDER BY b.gcm_name, a.gih_price 
	</select>
	
	<!-- 주성 추가 -->
	<select id="searchByGi_namePaging" resultType="com.storemanager.in.InDTO">
		SELECT 
			b.gcm_name,
			a.gih_idx, 
			a.gcm_code, 
			a.gi_code, 
			a.gi_name, 
			a.gih_inout, 
			a.gih_qty, 
			a.gih_price, 
			a.gih_remark,
			TO_CHAR(a.gih_regdate,'YYYY-MM-DD') gih_regdate,
			a.gih_confirm, 
			(a.gih_qty * a.gih_price) tot_price
	  FROM GE_ITEMS_HIST a JOIN GE_COM_MEMBER b
	  ON a.gcm_code = b.gcm_code
		WHERE a.gih_qty > 0 AND a.gi_name = #{gi_name}
		<if test="start != null and end!= null">
		  AND DATE_FORMAT(a.gih_regdate,'%Y-%m-%d') BETWEEN #{start} AND #{end}
		</if>
		ORDER BY b.gcm_name, a.gih_price
		LIMIT ${nowPage},10 
	</select>
	
	<!-- 거래처명 검색으로 리스트 뽑아오기 -->
	<select id="searchByGcm_name" resultType="com.storemanager.in.InDTO">
		SELECT 
			b.gcm_name,
			a.gih_idx, 
			a.gcm_code, 
			a.gi_code, 
			a.gi_name, 
			a.gih_inout, 
			a.gih_qty, 
			a.gih_price, 
			a.gih_remark,
			TO_CHAR(a.gih_regdate,'YYYY-MM-DD') gih_regdate,
			a.gih_confirm, 
			(a.gih_qty * a.gih_price) tot_price
	  FROM GE_ITEMS_HIST a JOIN GE_COM_MEMBER b
	  ON a.gcm_code = b.gcm_code
		WHERE a.gih_qty > 0 AND b.gcm_name = #{gcm_name}
		<if test="start != null and end != null">
			AND DATE_FORMAT(a.gih_regdate,'%Y-%m-%d') BETWEEN #{start} AND #{end}
		</if>
		ORDER BY a.gi_name , a.gih_price
	</select>
	
	<!-- 주성 추가 -->
	<select id="searchByGcm_namePaging" resultType="com.storemanager.in.InDTO">
		SELECT 
			b.gcm_name,
			a.gih_idx, 
			a.gcm_code, 
			a.gi_code, 
			a.gi_name, 
			a.gih_inout, 
			a.gih_qty, 
			a.gih_price, 
			a.gih_remark,
			TO_CHAR(a.gih_regdate,'YYYY-MM-DD') gih_regdate,
			a.gih_confirm, 
			(a.gih_qty * a.gih_price) tot_price
	  FROM GE_ITEMS_HIST a JOIN GE_COM_MEMBER b
	  ON a.gcm_code = b.gcm_code
		WHERE a.gih_qty > 0 AND b.gcm_name = #{gcm_name}
		<if test="start != null and end != null">
			AND DATE_FORMAT(a.gih_regdate,'%Y-%m-%d') BETWEEN #{start} AND #{end}
		</if>
		ORDER BY a.gi_name , a.gih_price
		LIMIT ${nowPage},10
	</select>
	
	<!-- 가격 검색으로 리스트 뽑아오기 -->
	<select id="searchByGih_price" resultType="com.storemanager.in.InDTO">
		SELECT 
			b.gcm_name,
			a.gih_idx, 
			a.gcm_code, 
			a.gi_code, 
			a.gi_name, 
			a.gih_inout, 
			a.gih_qty, 
			a.gih_price, 
			a.gih_remark,
			TO_CHAR(a.gih_regdate,'YYYY-MM-DD') gih_regdate,
			a.gih_confirm, 
			(a.gih_qty * a.gih_price) tot_price
	  FROM GE_ITEMS_HIST a JOIN GE_COM_MEMBER b
	  ON a.gcm_code = b.gcm_code
		WHERE a.gih_qty > 0 AND a.gih_price = #{gih_price}
		<if test="start != null and end != null">
			AND DATE_FORMAT(a.gih_regdate,'%Y-%m-%d') BETWEEN #{start} AND #{end}
		</if>
		ORDER BY a.gi_name
	</select>
	
	<!-- 주성 추가 -->
	<select id="searchByGih_pricePaging" resultType="com.storemanager.in.InDTO">
		SELECT 
			b.gcm_name,
			a.gih_idx, 
			a.gcm_code, 
			a.gi_code, 
			a.gi_name, 
			a.gih_inout, 
			a.gih_qty, 
			a.gih_price, 
			a.gih_remark,
			TO_CHAR(a.gih_regdate,'YYYY-MM-DD') gih_regdate,
			a.gih_confirm, 
			(a.gih_qty * a.gih_price) tot_price
	  FROM GE_ITEMS_HIST a JOIN GE_COM_MEMBER b
	  ON a.gcm_code = b.gcm_code
		WHERE a.gih_qty > 0 AND a.gih_price = #{gih_price}
		<if test="start != null and end != null">
			AND DATE_FORMAT(a.gih_regdate,'%Y-%m-%d') BETWEEN #{start} AND #{end}
		</if>
		ORDER BY a.gi_name
		LIMIT ${nowPage}, 10
	</select>
	
</mapper>  