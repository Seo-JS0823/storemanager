<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.storemanager.item.ItemMapper">

<<<<<<< HEAD
    <select id="selectItemList" resultType="com.storemanager.item.ItemDTO">
    SELECT
        i.GI_CODE    AS giCode,
        i.GI_NAME    AS giName,
        i.GCM_CODE   AS gcmCode,
        c.GCM_NAME   AS gcmName
    FROM
        GE_ITEMS i
    LEFT JOIN
        GE_COM_MEMBER c ON i.GCM_CODE = c.GCM_CODE
    WHERE
        i.GI_DEL_FLAG = 'N'
    ORDER BY
        i.GI_CODE DESC
    </select>
    
    <select id="selectItemById" parameterType="string" resultType="com.storemanager.item.ItemDTO">
        SELECT
            i.GI_CODE    AS giCode,
            i.GI_NAME    AS giName,
            i.GCM_CODE   AS gcmCode,
            c.GCM_NAME   AS gcmName, 
            i.GI_IMG     AS giImg,
            i.GI_REMARK     AS giRemark
=======
    <select id="findAllItems" resultType="com.storemanager.item.ItemDTO">
        SELECT
            gi.GI_CODE      AS giCode,
            gi.GI_NAME      AS giName,
            gcm.GCM_CODE    AS gcmCode,
            gcm.GCM_NAME    AS gcmName,
            gis.GIS_TOT_QTY AS gisTotQty
>>>>>>> edd0af4572442d2de9b4ca0b709f7328a36b019f
        FROM
            GE_ITEMS gi
        LEFT JOIN
            GE_COM_MEMBER gcm ON gi.GCM_CODE = gcm.GCM_CODE
        LEFT JOIN
            GE_ITEMS_STOCK gis ON gi.GI_CODE = gis.GI_CODE
        ORDER BY
            gi.GI_CODE DESC
    </select>
<<<<<<< HEAD

    <insert id="insertItem" parameterType="com.storemanager.item.ItemDTO">
        INSERT INTO GE_ITEMS (
            GI_NAME, GCM_CODE, GI_IMG, GI_REMARK, GI_DEL_FLAG
        ) 
        VALUES (
            #{giName}, #{gcmCode}, #{giImg}, #{giRemark}, 'N'
        )
    </insert>

    <update id="updateItem" parameterType="com.storemanager.item.ItemDTO">
        UPDATE 
            GE_ITEMS 
        SET 
            GI_NAME = #{giName}, 
            GCM_CODE = #{gcmCode},
            GI_IMG = #{giImg},
            GI_REMARK = #{giRemark}
        WHERE 
            GI_CODE = #{giCode}
    </update>

    <update id="deleteItem" parameterType="string">
        UPDATE GE_ITEMS
        SET GI_DEL_FLAG = 'Y'
        WHERE GI_CODE =  #{giCode}
    </update>
    
<select id="findItems" parameterType="map" resultType="com.storemanager.item.ItemDTO">
    SELECT
    i.GI_CODE AS giCode,
    i.GI_NAME AS giName,
    i.GCM_CODE AS gcmCode,
    c.GCM_NAME AS gcmName,
    i.GI_DEL_FLAG AS giDelFlag
    FROM
    GE_ITEMS i
    LEFT JOIN
    GE_COM_MEMBER c ON i.GCM_CODE = c.GCM_CODE
    <where>
        <if test="!includeDeleted">
            AND i.GI_DEL_FLAG = 'N'
        </if>
        
        <if test="search != null and search != '' and search.trim() != '' and searchOption != null">
            AND 
             <choose>
                <when test="searchOption == 'item_code'">
                    i.GI_CODE = #{search}
                </when>
                <when test="searchOption == 'item_name'">
                    i.GI_NAME LIKE '%' || #{search} || '%'
                </when>
                <when test="searchOption == 'supplier_name'">
                    c.GCM_NAME LIKE '%' || #{search} || '%'
                </when>
                <otherwise>
                    i.GI_NAME LIKE '%' || #{search} || '%'
                </otherwise>
            </choose>
        </if>
    </where>
    ORDER BY
    i.GI_CODE DESC
</select>
	
	<update id="restoreItem" parameterType="string">
		UPDATE GE_ITEMS 
		SET GI_DEL_FLAG = 'N'
		WHERE GI_CODE = #{giCode}
	</update>

=======
    
    <!-- 새 품목 등록 -->
    <insert id="saveNewItem" parameterType="com.storemanager.item.ItemDTO">
        INSERT INTO GE_ITEMS (
            GI_NAME, 
            GCM_CODE
        ) VALUES (
            #{giName},   -- DTO의 giName 필드 값을 여기에 넣음
            #{gcmCode}   -- DTO의 gcmCode 필드 값을 여기에 넣음
        )
    </insert>
    
>>>>>>> edd0af4572442d2de9b4ca0b709f7328a36b019f
</mapper>